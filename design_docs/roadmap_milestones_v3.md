# NeoMAGI 产品路线图 v3（Product-Oriented）

> 基于 v2 (`design_docs/roadmap_milestones_v2.md`) 演进。  
> 日期：2026-02-19

## 1. 这份 roadmap 管什么，不管什么

### 管什么（产品层）
- 目标用户价值（用户为什么需要这个阶段）。
- 阶段边界（做什么 / 不做什么）。
- 验收标准（是否“对用户可用”）。
- 里程碑优先级和推荐顺序。

### 不管什么（实现层）
- 不写任务拆分、owner、工期、代码级实现步骤。
- 不做 micro management。
- 技术方案细节写入 architecture 文档与 `decisions/`。

---

## 2. 当前进展快照（截至 2026-02-19）

- `M0`：已完成（治理与决策追踪）。
- `M1.1 ~ M1.4`：已完成（基础交互、任务闭环、稳定性、测试与 CI 基线）。
- 当前阶段判断：系统已达到“能用且稳定”，下一阶段应优先解决“可控授权下的可执行能力”。

---

## 3. 里程碑（产品视角）

### M1.5：可控执行闭环（Tool Modes）
**用户价值**
- 用户可以把“写代码+执行验证”的任务交给 agent，同时保持可控和可预期。

**边界**
- In:
  - 工具按模式授权（至少区分 `chat_safe` 与 `coding`）。
  - `coding` 模式支持完整的“读-写-改-执行”任务闭环。
  - 高风险操作有明确拒绝或确认机制。
- Out:
  - 不追求复杂权限系统（如多角色 RBAC、组织级策略中心）。
  - 不在本阶段引入过多外部系统权限集成。

**验收标准（Use Case）**
- 用例 A：用户要求“修复 bug 并跑测试”，agent 可在一次会话内完成并返回可验证结果。
- 用例 B：在 `chat_safe` 模式下，涉及写入/执行类工具会被明确拒绝并说明原因。
- 用例 C：高风险命令不会静默执行，用户能感知并控制风险。

---

### M2：会话内连续性
**用户价值**
- 长对话、多轮任务过程中，agent 不会“失忆”或角色漂移。

**边界**
- In:
  - 会话内上下文治理（包括接近窗口上限时的连续性保障）。
  - 会话内角色与偏好稳定保持。
- Out:
  - 不解决跨天/跨会话记忆（那是 M3）。

**验收标准（Use Case）**
- 用例 A：用户连续进行 30+ 轮任务后，关键约束仍被正确遵守。
- 用例 B：会话压缩后继续提问，关键上下文可延续，任务不中断。

---

### M3：会话外持久记忆
**用户价值**
- 隔天继续对话时，agent 能记住用户偏好、长期目标和已确认事实。

**边界**
- In:
  - 短期记忆沉淀与长期记忆策展形成闭环。
  - 记忆可检索、可复用、可治理（可纠错/可更新）。
- Out:
  - 不追求“全知全记”，不做重型知识图谱工程。

**验收标准（Use Case）**
- 用例 A：用户前一天明确的偏好，第二天无需重复输入即可生效。
- 用例 B：用户追问历史决策原因，agent 能基于记忆给出可追溯回答。

---

### M6：模型迁移验证
**用户价值**
- 用户不被单一模型供应商绑定，关键任务可迁移且可回退。

**边界**
- In:
  - OpenAI 为默认路径，Gemini 做等价任务验证。
  - 定义切换与回退策略。
- Out:
  - 不在本阶段扩展到过多 provider。

**验收标准（Use Case）**
- 用例 A：同一批代表性任务在 OpenAI 与 Gemini 均可完成。
- 用例 B：切换后若质量或稳定性下降，可快速回退到默认路径。

---

### M4：第二渠道适配（Telegram）
**用户价值**
- 用户可在 WebChat 之外，通过第二入口稳定使用同一 agent 能力。

**边界**
- In:
  - Telegram 打通核心任务流程。
  - 关键行为策略与 WebChat 保持一致。
- Out:
  - 不做多渠道复杂运营功能（群控、营销、自动化运营等）。

**验收标准（Use Case）**
- 用例 A：用户在 Telegram 发起核心任务，完成体验与 WebChat 一致。
- 用例 B：渠道切换不改变核心能力边界和安全策略。

---

### M5：运营可靠性（后置触发）
**用户价值**
- 当使用频率上升时，系统仍可观测、可恢复、可维护。

**触发条件（任一满足即可进入）**
- 稳定性问题开始影响日常使用。
- 数据安全/恢复风险上升。
- 维护成本明显上升。

**边界**
- In:
  - 最小观测、备份与恢复能力。
- Out:
  - 不提前建设企业级运维平台。

**验收标准（Use Case）**
- 用例 A：出现异常后，用户或维护者可以在可接受时间内恢复服务。
- 用例 B：关键数据具备基本保护和恢复路径。

---

## 4. 推荐顺序（v3）
1. M1.5（可控执行闭环）
2. M2（会话内连续性）
3. M3（会话外持久记忆）
4. M6（模型迁移验证）
5. M4（第二渠道适配）
6. M5（触发式进入）

---

## 5. 阶段切换规则
- 未达到当前阶段验收标准，不进入下一阶段。
- 新需求优先归类到当前阶段；若越界，先做取舍再纳入。
- 每阶段结束后仅做三类决策：`保留 / 推迟 / 放弃`。

---

## 6. 版本变更记录
| 版本 | 日期 | 变更 | 依据 |
| --- | --- | --- | --- |
| v1 | 2026-02-16 | 初始版本 | — |
| v2 | 2026-02-18 | 新增 M1.4（审计修复收尾 + 测试基建） | ADR 0018 |
| v3 | 2026-02-19 | roadmap 转为产品导向；新增 M1.5（可控执行闭环）；重排后续顺序 | ADR 0023 + ADR 0024 |
